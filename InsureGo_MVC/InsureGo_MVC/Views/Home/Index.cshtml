@using System.Linq
@model IEnumerable<dynamic>

@{
    ViewBag.Title = "Home Page";
}

<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #e3f2fd, #ffffff);
    }

    /* ================= HEADER ================= */
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        background-color: #0056b3;
        color: white;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    }

        header a {
            font-size: 14px;
            color: white;
            text-decoration: none;
            background: #dc3545;
            padding: 8px 14px;
            border-radius: 6px;
        }

    /* ================= GRID ================= */
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 25px;
        margin-top: 30px;
    }

    /* ================= CARD ================= */
    .card {
        background: #fff;
        border-radius: 14px;
        padding: 24px;
        text-align: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        animation: slideUpFade 0.6s ease forwards;
    }

        .card h2, .card h3 {
            margin-bottom: 18px;
            color: #007bff;
        }

        /* ================= QUICK ACTIONS ================= */
        .card img {
            width: 75px;
            margin-bottom: 12px;
        }

        .card p {
            font-size: 14px;
            color: #555;
            min-height: 36px;
        }

    /* ================= BUTTON ================= */
    .btn {
        display: inline-block;
        padding: 10px 16px;
        background: #007bff;
        color: #fff !important;
        border-radius: 8px;
        font-size: 14px;
        text-decoration: none;
        transition: 0.2s;
    }

        .btn:hover {
            background: #0056b3;
        }

    .btn-sm {
        padding: 6px 10px;
        font-size: 12px;
        background-color: #0056b3;
    }

    /* ================= SUCCESS MESSAGE ================= */
    .alert-success {
        margin-top: 25px;
        padding: 18px;
        background: #e6f4ea;
        border-left: 6px solid #28a745;
        border-radius: 10px;
    }

    /* ================= TABLE ================= */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 5px 18px rgba(0,0,0,0.08);
    }

        table th {
            background: #007bff;
            color: white;
            padding: 12px;
        }

        table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        table tr:hover {
            background: #f1f7ff;
        }

    .status-approved {
        background: #28a745;
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
    }

    .status-pending {
        background: #ffc107;
        color: black;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
    }

    .text-muted {
        color: gray;
        font-size: 12px;
        font-style: italic;
    }

    /* ================= ANIMATIONS ================= */
    @@keyframes slideUpFade {
        from {
            opacity: 0;
            transform: translateY(25px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ================= MOBILE ================= */
    @@media (max-width: 768px) {
        .grid {
            grid-template-columns: 1fr;
        }

        header {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }

        table {
            font-size: 13px;
        }
    }
</style>

<!-- ================= HEADER ================= -->
<header>
    <h2>Hi @Session["UserName"] 👋</h2>
    <a href="/Account/Logout">Logout</a>
</header>

<!-- ================= QUICK ACTIONS ================= -->
<section class="grid">
    <div class="card">
        <img src="https://cdn-icons-png.flaticon.com/512/3209/3209265.png" />
        <h3>Buy Insurance</h3>
        <p>Select motor or travel insurance plans that suit your needs.</p>
        <a class="btn" href="@Url.Action("Add", "Vehicle")">Buy Now</a>
    </div>

    <div class="card">
        <img src="https://cdn-icons-png.flaticon.com/512/2910/2910768.png" />
        <h3>Renew Policy</h3>
        <p>Renew your policy instantly without any paperwork.</p>
        <a class="btn" href="@Url.Action("Renew", "Insurance")">Renew</a>
    </div>

    <div class="card">
        <img src="https://cdn-icons-png.flaticon.com/512/942/942196.png" />
        <h3>Estimate Premium</h3>
        <p>Calculate premiums for two-wheelers and four-wheelers.</p>
        <a class="btn" href="@Url.Action("Calculate", "Premium")">Calculate</a>
    </div>

    <div class="card">
        <img src="https://cdn-icons-png.flaticon.com/512/3588/3588294.png" />
        <h3>Claim Insurance</h3>
        <p>File insurance claims online and track their status.</p>
        <a class="btn" href="@Url.Action("Create", "Claim")">File Claim</a>
    </div>
</section>

<!-- ================= WHY INSURANCE ================= -->
<div class="card" style="margin-top:40px; text-align:left;">
    <h2>Why Insurance Matters</h2>
    <p>Life is unpredictable. Accidents, theft, natural disasters, and medical emergencies can strike without warning. Insurance acts as a financial safety shield that protects you from sudden and heavy expenses.</p>
    <p>Motor insurance covers vehicle damage, third-party liabilities, and repair costs. Travel insurance protects you from trip cancellations, medical emergencies, and losses. Insurance gives peace of mind when life throws surprises.</p>
    <ul>
        <li>✔ Financial security during emergencies</li>
        <li>✔ Mandatory legal compliance</li>
        <li>✔ Cashless repairs at network garages</li>
        <li>✔ Fast and transparent claim process</li>
        <li>✔ Flexible coverage options</li>
    </ul>
    <p>Insurance isn’t an expense — it’s protection for your future. We make it digital, quick, and stress-free.</p>
</div>

<!-- ================= SUCCESS MESSAGE ================= -->
@if (ViewBag.Success != null && ViewBag.PolicyNumber != null && ViewBag.Policies != null)
{
    var approvedPolicy = ((IEnumerable<dynamic>)ViewBag.Policies)
        .FirstOrDefault(p => p.PolicyNumber == ViewBag.PolicyNumber);

    if (approvedPolicy != null)
    {
        <div class="alert-success">
            <strong>@ViewBag.Success</strong><br />
            Policy Number: <b>@ViewBag.PolicyNumber</b><br /><br />
            <a class="btn" href="@Url.Action("Details", "Policy", new { id = approvedPolicy.PolicyNumber })">
                View Policy Details
            </a>
        </div>
    }
}

<!-- ================= USER POLICIES ================= -->
@if (ViewBag.Policies != null && ViewBag.Policies.Count > 0)
{
    <h2 style="margin-top:30px;">Your Policies</h2>
    <table>
        <thead>
            <tr>
                <th>Policy Number</th>
                <th>Vehicle</th>
                <th>Registration</th>
                <th>Plan</th>
                <th>Duration</th>
                <th>Premium</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var p in ViewBag.Policies)
            {
                <tr>
                    <td>@p.PolicyNumber</td>
                    <td>@p.VehicleModel</td>
                    <td>@p.RegistrationNumber</td>
                    <td>@p.PlanType</td>
                    <td>@p.Duration</td>
                    <td>₹ @p.PremiumAmount</td>
                    <td>
                        <span class="@(p.PolicyStatus == "Approved" ? "status-approved" : "status-pending")">
                            @p.PolicyStatus
                        </span>
                    </td>
                    <td>
                        @if (p.PolicyStatus != "Pending")
                        {
                            <a class="btn btn-sm" href="@Url.Action("ClaimHistory", "Insurance", new { policyNumber = p.PolicyNumber })">
                                Claim History
                            </a>
                            <a class="btn btn-sm" href="@Url.Action("Details", "Policy", new { id = p.PolicyNumber })">
                                Policy Details
                            </a>
                        }
                        else
                        {
                            <span class="text-muted">Awaiting Approval</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No policies found.</p>
}

@if (TempData["ShowPaymentPopup"] != null && TempData["PolicyNumber"] != null)
{
    <script>
        window.onload = function () {
            alert("Payment Successful! Your Policy Number is: " +
                '@TempData["PolicyNumber"]' +
                "\nIt will be fully accessible after admin approval.");
        };
    </script>
}
